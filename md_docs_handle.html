<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>node-addon-layer: Native Handles</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">node-addon-layer
   </div>
   <div id="projectbrief">C API For writing Node modules</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Native Handles </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A common pattern is to write a binding to a library that intializes and returns a handle that is used for all subsequent library operations. Similarly you will want to know when it is necessary to clean up the underlying resources (without necessarily being explicit in JavaScript).</p>
<div class="fragment"><div class="line"><span class="comment">/* Called when the handle is about to be collected by the VM */</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">handle_free_cb(<a class="code" href="group__core.html#ga11881607db69d18ac533345a1f5d40e2">shim_val_t</a>* phandle, <span class="keywordtype">void</span>* data)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* unwrap the handle */</span></div>
<div class="line">  <span class="keywordtype">void</span>* handle = <a class="code" href="group__externals.html#ga4ef5ce8c0444f281d0cf49f5d8537b6d">shim_external_value</a>(phandle);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* cleanup any resources for the library */</span></div>
<div class="line">  some_library_free(handle);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* cleanup any resources for the value */</span></div>
<div class="line">  <a class="code" href="group__persistents.html#ga510f55514e24cc09949d0343e7c252e1">shim_persistent_dispose</a>(phandle);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__core.html#gaab77202d0d00070f145e35d1299b0697">shim_bool_t</a></div>
<div class="line">library_init(<a class="code" href="group__core.html#ga01debe564a9759f12e6e89d300b07c9e">shim_ctx_t</a>* ctx, <a class="code" href="group__core.html#ga7ac61a620e8b04007a7ed3445b6c76c1">shim_args_t</a>* args)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* Initialize some library */</span></div>
<div class="line">  <span class="keywordtype">void</span>* handle = some_library_init();</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Wrap the library handle in an external */</span></div>
<div class="line">  <a class="code" href="group__core.html#ga11881607db69d18ac533345a1f5d40e2">shim_val_t</a>* ehandle = <a class="code" href="group__externals.html#gad8c34362075c28c5fad2e8daf100906f">shim_external_new</a>(ctx, handle);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Turn the handle into a Persistent */</span></div>
<div class="line">  <a class="code" href="group__core.html#ga11881607db69d18ac533345a1f5d40e2">shim_val_t</a>* phandle = <a class="code" href="group__persistents.html#gacabfcfa8aa01d74d0d4189a0d77e6f60">shim_persistent_new</a>(ctx, ehandle);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Release the original wrapper */</span></div>
<div class="line">  <a class="code" href="group__primitives.html#gab5409cb002417a0324b1ca43b41c4dd2">shim_value_release</a>(ehandle);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">   * Only valid for persistents, use this to get notified if JavaScript</span></div>
<div class="line"><span class="comment">   * is about to collect your object, this lets you handle any finalizer</span></div>
<div class="line"><span class="comment">   * work on your own</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  <a class="code" href="group__persistents.html#gadad95ae5256a3e9960447fcd6afb88a3">shim_obj_make_weak</a>(ctx, phandle, NULL, handle_free_cb);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* return the handle to JavaScript */</span></div>
<div class="line">  <a class="code" href="group__arguments.html#ga2d273b98a97af9e849456d2b0748aa41">shim_args_set_rval</a>(ctx, args, phandle);</div>
<div class="line">  <span class="keywordflow">return</span> TRUE;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 7 2013 15:17:55 for node-addon-layer by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.4
</small></address>
</body>
</html>
